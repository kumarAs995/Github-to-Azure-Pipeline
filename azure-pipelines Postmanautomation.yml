# azure-pipelines.yml
trigger:
  branches:
    include:
      - main   # Runs pipeline on commits to main branch

pool:
  vmImage: 'windows-latest'

steps:
# 1. Install Postman CLI
- powershell: |
    Invoke-WebRequest -Uri "https://dl-cli.pstmn.io/download/latest/win64" -OutFile "postman-cli.zip"
    Expand-Archive -Path "postman-cli.zip" -DestinationPath "C:\postman-cli"
    $env:PATH += ";C:\postman-cli"
  displayName: 'Install Postman CLI'

# 2. Authenticate Postman CLI using API Key
- script: |
    postman login --with-api-key $(POSTMAN_API_KEY)
  displayName: 'Authenticate Postman CLI'

# 3. Run Postman Collection for DemoQA and DemoDev environments
- script: |
    echo "Running Postman Collection for DemoQA..."
    postman collection run "EmployeeNewHire" --environment "DemoQA"
    
    echo "Running Postman Collection for DemoDev..."
    postman collection run "EmployeeNewHire" --environment "DemoDev"
  displayName: 'Run Postman Collections'